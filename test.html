<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学业预警系统</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #858796;
            --success-color: #1cc88a;
            --warning-color: #f6c23e;
            --danger-color: #e74a3b;
        }
        
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background: #f8f9fc;
            min-height: 100vh;
            display: flex;
            color: #333;
        }
        
        .sidebar {
            width: 250px;
            background: #4e73df;
            color: white;
            padding: 1rem;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            margin: 0.2rem 0;
            border-radius: 0.35rem;
            display: flex;
            align-items: center;
            text-decoration: none;
        }
        
        .sidebar .nav-link i {
            margin-right: 0.5rem;
        }
        
        .sidebar .nav-link:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .main-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: #fff;
        }
        
        .card {
            background: #fff;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            color: #333;
        }
        
        .table {
            color: #333;
        }
        
        .table thead th {
            background-color: #f8f9fc;
            border-bottom: 2px solid #e3e6f0;
            color: #333;
        }
        
        .table-hover tbody tr:hover {
            background-color: #f8f9fc;
        }
        
        .form-control, .form-select {
            background-color: #fff;
            border: 1px solid #d1d3e2;
            color: #333;
        }
        
        .form-control:focus, .form-select:focus {
            background-color: #fff;
            border-color: #bac8f3;
            color: #333;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #2196f3, #1976d2);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #1976d2, #1565c0);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #2196f3, #1976d2);
            border: none;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(45deg, #1976d2, #1565c0);
        }
        
        .text-muted {
            color: #858796 !important;
        }
        
        .modal-content {
            background: #fff;
            color: #333;
        }
        
        .modal-header {
            border-bottom: 1px solid #e3e6f0;
        }
        
        .modal-footer {
            border-top: 1px solid #e3e6f0;
        }

        .modal-title {
            color: #333;
        }

        .modal-content .form-control, 
        .modal-content .form-select {
            background-color: #fff;
            border: 1px solid #d1d3e2;
            color: #333;
        }

        .modal-content .form-control:focus, 
        .modal-content .form-select:focus {
            background-color: #fff;
            border-color: #bac8f3;
            color: #333;
            box-shadow: 0 0 0 0.25rem rgba(78, 115, 223, 0.25);
        }

        .modal-content .form-label {
            color: #333;
            font-weight: 500;
        }

        .modal-content .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
        
        .list-group-item {
            background: #fff;
            border: 1px solid #e3e6f0;
            color: #333;
        }
        
        .list-group-item:hover {
            background: #f8f9fc;
        }

        @media print {
            .sidebar, .btn-group, .pagination, .form-select {
                display: none !important;
            }
            .main-content {
                width: 100% !important;
                padding: 0 !important;
            }
        }

        /* 页面内容样式 */
        .page-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .page-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 学生信息表格样式 */
        .student-table th {
            background-color: #f8f9fc;
            font-weight: 600;
        }

        .student-table td {
            vertical-align: middle;
        }

        .badge {
            font-size: 0.85em;
            padding: 0.5em 0.8em;
        }

        .search-box {
            background: #fff;
            border-radius: 0.35rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(0, 0, 0, 0.1);
        }

        .action-buttons .btn {
            margin-right: 0.3rem;
        }

        .modal-lg {
            max-width: 800px;
        }

        .required-field::after {
            content: "*";
            color: red;
            margin-left: 4px;
        }

        /* 倒计时样式 */
        .countdown-timer {
            background: #f8f9fc;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .time-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .time-value {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: bold;
            color: #4e73df;
            min-width: 60px;
            text-align: center;
        }

        .analysis-active .time-value {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="text-center py-4">
            <h4>学业预警系统</h4>
        </div>
        <nav>
            <a href="#" class="nav-link active" data-page="student-info">
                <i class="fas fa-user-graduate"></i>学生信息
            </a>
            <a href="#" class="nav-link" data-page="model-training">
                <i class="fas fa-brain"></i>学业预警模型
            </a>
            <a href="#" class="nav-link" data-page="classroom-monitor">
                <i class="fas fa-video"></i>课堂监控
            </a>
        </nav>
    </div>

    <!-- 主要内容区域 -->
    <div class="main-content">
        <!-- 学生信息页面 -->
        <div class="page-content active" id="student-info">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>学生信息管理</h2>
                <button class="btn btn-primary" onclick="openAddStudentModal()">
                    <i class="fas fa-plus"></i> 添加学生
                </button>
            </div>
            <div class="row mb-3">
                <div class="col-md-4">
                    <input type="text" class="form-control" id="searchStudentNo" placeholder="按学号搜索">
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary w-100" onclick="searchStudentByNo()">搜索</button>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="warningFilter" onchange="renderStudentList(document.getElementById('searchStudentNo').value.trim())">
                        <option value="all">全部学生</option>
                        <option value="正常">正常</option>
                        <option value="轻度预警">轻度预警</option>
                        <option value="中度预警">中度预警</option>
                        <option value="重度预警">重度预警</option>
                    </select>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>学号</th>
                            <th style="cursor:pointer;" onclick="toggleWarningSort()">
                                预警程度 <span id="warningSortIcon">↑</span>
                            </th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="studentListBody">
                        <!-- 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- 详细信息模态框 -->
        <div class="modal fade" id="studentDetailModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">学生详细信息</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" id="studentDetailBody">
                        <!-- 动态生成 -->
                    </div>
                </div>
            </div>
        </div>
        <!-- 添加/编辑学生模态框 -->
        <div class="modal fade" id="addEditStudentModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addEditModalTitle">添加学生</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addEditStudentForm">
                            <input type="hidden" id="editStudentId">
                            <div class="mb-3">
                                <label class="form-label">学号</label>
                                <input type="text" class="form-control" id="editStudentNo" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">姓名</label>
                                <input type="text" class="form-control" id="editName" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">身份证号</label>
                                <input type="text" class="form-control" id="editIdCard" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">专业</label>
                                <input type="text" class="form-control" id="editMajor" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">年级</label>
                                <input type="text" class="form-control" id="editGrade" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">GPA</label>
                                <input type="number" class="form-control" id="editGpa" step="0.01" min="0" max="4">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">出勤率</label>
                                <input type="number" class="form-control" id="editAttendance" min="0" max="100">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">在线学习时长(小时)</label>
                                <input type="number" class="form-control" id="editStudyTime" min="0">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">借阅次数</label>
                                <input type="number" class="form-control" id="editBorrowCount" min="0">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">活动次数</label>
                                <input type="number" class="form-control" id="editActivityCount" min="0">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">考试分数</label>
                                <input type="number" class="form-control" id="editExamScore" min="0" max="100">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" onclick="saveStudent()">保存</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 删除确认模态框 -->
        <div class="modal fade" id="deleteStudentModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">确认删除</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>确定要删除该学生信息吗？</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">删除</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 模型训练页面 -->
        <div class="page-content" id="model-training">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>模型训练管理</h2>
                <button class="btn btn-primary" onclick="startTraining()">
                    <i class="fas fa-play"></i> 开始训练
                </button>
            </div>

            <!-- 模型训练状态卡片 -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">回归模型</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="mb-1">MSE: <span id="regressionMSE">-</span></p>
                                    <p class="mb-0">R²: <span id="regressionR2">-</span></p>
                                </div>
                                <div class="text-success">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">分类模型</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="mb-1">准确率: <span id="classificationAccuracy">-</span></p>
                                    <p class="mb-0">F1分数: <span id="classificationF1">-</span></p>
                                </div>
                                <div class="text-success">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">训练状态</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="mb-1">最后训练时间: <span id="lastTrainingTime">-</span></p>
                                    <p class="mb-0">训练状态: <span id="trainingStatus">未开始</span></p>
                                </div>
                                <div class="text-primary">
                                    <i class="fas fa-clock fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 模型可视化区域 -->
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">特征重要性</h5>
                            <div id="featureImportanceChart" style="height: 300px;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">预测结果分布</h5>
                            <div id="predictionDistributionChart" style="height: 300px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 模型评估结果表格 -->
            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title">模型评估结果</h5>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>模型类型</th>
                                    <th>评估指标</th>
                                    <th>训练集得分</th>
                                    <th>测试集得分</th>
                                    <th>交叉验证得分</th>
                                </tr>
                            </thead>
                            <tbody id="modelEvaluationTable">
                                <!-- 数据将通过JavaScript动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 课堂监控页面 -->
        <div class="page-content" id="classroom-monitor">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>课堂监控</h2>
                <div>
                    <button class="btn btn-primary me-2" onclick="startVideoAnalysis()">
                        <i class="fas fa-play"></i> 开始分析
                    </button>
                    <button class="btn btn-danger" onclick="stopVideoAnalysis()">
                        <i class="fas fa-stop"></i> 停止分析
                    </button>
                </div>
            </div>

            <!-- 监控状态卡片 -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">专注度</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h3 class="mb-0" id="focusScore">-</h3>
                                    <p class="text-muted mb-0">实时分数</p>
                                </div>
                                <div class="text-success">
                                    <i class="fas fa-chart-line fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">疲劳指数</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h3 class="mb-0" id="fatigueScore">-</h3>
                                    <p class="text-muted mb-0">实时指数</p>
                                </div>
                                <div class="text-warning">
                                    <i class="fas fa-tired fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">分心等级</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h3 class="mb-0" id="distractionLevel">-</h3>
                                    <p class="text-muted mb-0">当前等级</p>
                                </div>
                                <div class="text-danger">
                                    <i class="fas fa-exclamation-triangle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">分析状态</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h3 class="mb-0" id="analysisStatus">未开始</h3>
                                    <div class="d-flex align-items-center mt-2">
                                        <div class="countdown-timer">
                                            <span class="time-label">剩余时间:</span>
                                            <span class="time-value" id="remainingTime">03:00</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-primary">
                                    <i class="fas fa-video fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 视频分析区域 -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">视频分析</h5>
                            <div class="video-container" style="position: relative;">
                                <video id="analysisVideo" width="100%" style="background: #000;">
                                    您的浏览器不支持视频播放
                                </video>
                                <canvas id="overlayCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">实时状态</h5>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>指标</th>
                                            <th>数值</th>
                                            <th>状态</th>
                                        </tr>
                                    </thead>
                                    <tbody id="realtimeData">
                                        <tr>
                                            <td>专注度</td>
                                            <td id="focusValue">-</td>
                                            <td id="focusStatus">-</td>
                                        </tr>
                                        <tr>
                                            <td>疲劳度</td>
                                            <td id="fatigueValue">-</td>
                                            <td id="fatigueStatus">-</td>
                                        </tr>
                                        <tr>
                                            <td>分心等级</td>
                                            <td id="distractionValue">-</td>
                                            <td id="distractionStatus">-</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 分析结果表格 -->
            <div class="card mt-4" id="analysisResults" style="display: none;">
                <div class="card-body">
                    <h5 class="card-title">分析结果</h5>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>指标</th>
                                    <th>平均值</th>
                                    <th>最高值</th>
                                    <th>最低值</th>
                                    <th>状态评估</th>
                                </tr>
                            </thead>
                            <tbody id="analysisTableBody">
                                <!-- 数据将通过JavaScript动态生成 -->
                            </tbody>
                        </table>
                    </div>
                    <div class="text-end mt-3">
                        <button class="btn btn-primary" onclick="exportAnalysisData()">
                            <i class="fas fa-download"></i> 导出数据
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入Bootstrap JS -->
    <script src="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

    <!-- 引入ECharts -->
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>

    <script>
        // API基础URL
        const API_BASE_URL = 'http://localhost:8080/api';  // Spring Boot默认端口

        // API请求函数
        async function fetchAPI(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include'  // 包含cookies
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('API请求错误:', error);
                throw error;
            }
        }

        // 获取学生列表
        async function fetchStudents() {
            try {
                const response = await fetchAPI('/students');
                return response.data || [];
            } catch (error) {
                console.error('获取学生列表失败:', error);
                return [];
            }
        }

        // 添加学生
        async function addStudentAPI(studentData) {
            try {
                return await fetchAPI('/students', 'POST', studentData);
            } catch (error) {
                console.error('添加学生失败:', error);
                throw error;
            }
        }

        // 更新学生信息
        async function updateStudentAPI(id, studentData) {
            try {
                return await fetchAPI(`/students/${id}`, 'PUT', studentData);
            } catch (error) {
                console.error('更新学生信息失败:', error);
                throw error;
            }
        }

        // 删除学生
        async function deleteStudentAPI(id) {
            try {
                return await fetchAPI(`/students/${id}`, 'DELETE');
            } catch (error) {
                console.error('删除学生失败:', error);
                throw error;
            }
        }

        // 搜索学生
        async function searchStudentsAPI(params) {
            try {
                const queryString = new URLSearchParams(params).toString();
                return await fetchAPI(`/students/search?${queryString}`);
            } catch (error) {
                console.error('搜索学生失败:', error);
                return [];
            }
        }

        // 全局变量
        let students = [];
        let currentPage = 1;
        let pageSize = 10;
        let filteredStudents = [];
        let warningSortOrder = 'asc'; // 默认升序
        function toggleWarningSort() {
            warningSortOrder = warningSortOrder === 'asc' ? 'desc' : 'asc';
            updateWarningSortIcon();
            renderStudentList(document.getElementById('searchStudentNo').value.trim());
        }
        function updateWarningSortIcon() {
            const icon = document.getElementById('warningSortIcon');
            icon.textContent = warningSortOrder === 'asc' ? '↑' : '↓';
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                students = await fetchStudents();
                filteredStudents = [...students];
                renderStudents();
                updatePagination();
            } catch (error) {
                console.error('初始化失败:', error);
                alert('加载数据失败，请刷新页面重试');
            }
        });

        // 更改每页显示条数
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSizeSelect').value);
            currentPage = 1;
            renderStudents();
            updatePagination();
        }

        // 渲染学生列表
        function renderStudents() {
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageStudents = filteredStudents.slice(start, end);
            
            const tbody = document.getElementById('studentListBody');
            tbody.innerHTML = pageStudents.map(student => `
                <tr>
                    <td>${student.studentNo}</td>
                    <td>${student.name}</td>
                    <td>${student.idCard}</td>
                    <td>${student.major}</td>
                    <td>${student.grade}</td>
                    <td>${student.gpa.toFixed(2)}</td>
                    <td>${student.attendance}%</td>
                    <td>${student.studyTime}小时</td>
                    <td>${student.borrowCount}次</td>
                    <td>${student.activityCount}次</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editStudent(${student.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteStudent(${student.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('totalRecords').textContent = `共 ${filteredStudents.length} 条记录`;
        }

        // 搜索学生
        async function searchStudents() {
            const searchParams = {
                id: document.getElementById('searchId').value,
                name: document.getElementById('searchName').value,
                major: document.getElementById('searchMajor').value,
                grade: document.getElementById('searchGrade').value
            };

            try {
                const response = await searchStudentsAPI(searchParams);
                filteredStudents = response.data || [];
                currentPage = 1;
                renderStudents();
                updatePagination();
            } catch (error) {
                console.error('搜索失败:', error);
                alert('搜索失败，请重试');
            }
        }

        // 编辑学生
        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;
            
            document.getElementById('modalTitle').textContent = '编辑学生';
            document.getElementById('studentId').value = student.id;
            document.getElementById('idCard').value = student.idCard;
            document.getElementById('name').value = student.name;
            document.getElementById('studentNo').value = student.studentNo;
            document.getElementById('major').value = student.major;
            document.getElementById('grade').value = student.grade;
            document.getElementById('gpa').value = student.gpa;
            document.getElementById('attendance').value = student.attendance;
            document.getElementById('studyTime').value = student.studyTime;
            document.getElementById('borrowCount').value = student.borrowCount;
            document.getElementById('activityCount').value = student.activityCount;

            new bootstrap.Modal(document.getElementById('addStudentModal')).show();
        }

        // 保存学生
        async function saveStudent() {
            const form = document.getElementById('studentForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const student = {
                id: document.getElementById('studentId').value,
                idCard: document.getElementById('idCard').value,
                name: document.getElementById('name').value,
                studentNo: document.getElementById('studentNo').value,
                major: document.getElementById('major').value,
                grade: document.getElementById('grade').value,
                gpa: parseFloat(document.getElementById('gpa').value) || 0,
                attendance: parseInt(document.getElementById('attendance').value) || 0,
                studyTime: parseInt(document.getElementById('studyTime').value) || 0,
                borrowCount: parseInt(document.getElementById('borrowCount').value) || 0,
                activityCount: parseInt(document.getElementById('activityCount').value) || 0
            };

            try {
                if (student.id) {
                    await updateStudentAPI(student.id, student);
                } else {
                    await addStudentAPI(student);
                }

                // 重新加载学生列表
                students = await fetchStudents();
                filteredStudents = [...students];
                currentPage = 1;
                
                // 关闭模态框
                bootstrap.Modal.getInstance(document.getElementById('addStudentModal')).hide();
                
                // 重新渲染表格和分页
                renderStudents();
                updatePagination();
                
                alert(student.id ? '更新成功' : '添加成功');
            } catch (error) {
                console.error('保存失败:', error);
                alert('保存失败，请重试');
            }
        }

        // 删除学生
        async function deleteStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;

            document.getElementById('deleteStudentName').textContent = student.name;
            document.getElementById('studentId').value = id;  // 保存要删除的学生ID
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        // 更新分页
        function updatePagination() {
            const totalPages = Math.ceil(filteredStudents.length / pageSize);
            const pagination = document.getElementById('pagination');
            
            let html = `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(1)">首页</a>
                </li>
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">&laquo;</a>
                </li>
            `;

            // 计算显示的页码范围
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            // 如果当前页在开头，显示更多后面的页码
            if (currentPage <= 3) {
                endPage = Math.min(5, totalPages);
            }
            // 如果当前页在结尾，显示更多前面的页码
            if (currentPage >= totalPages - 2) {
                startPage = Math.max(1, totalPages - 4);
            }

            // 添加省略号
            if (startPage > 1) {
                html += '<li class="page-item disabled"><span class="page-link">...</span></li>';
            }

            // 添加页码按钮
            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <li class="page-item ${currentPage === i ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>
                `;
            }

            // 添加省略号
            if (endPage < totalPages) {
                html += '<li class="page-item disabled"><span class="page-link">...</span></li>';
            }

            html += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">&raquo;</a>
                </li>
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${totalPages})">末页</a>
                </li>
            `;

            pagination.innerHTML = html;
        }

        // 切换页码
        function changePage(page) {
            const totalPages = Math.ceil(filteredStudents.length / pageSize);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderStudents();
                updatePagination();
            }
        }

        // 页面切换功能
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetPage = this.getAttribute('data-page');
                
                // 更新导航链接状态
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // 更新页面显示
                document.querySelectorAll('.page-content').forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(targetPage).classList.add('active');
            });
        });

        // 模型训练相关函数
        async function startTraining() {
            try {
                document.getElementById('trainingStatus').textContent = '训练中...';
                const response = await fetchAPI('/model/train', 'POST');
                
                // 更新训练状态
                document.getElementById('trainingStatus').textContent = '已完成';
                document.getElementById('lastTrainingTime').textContent = new Date().toLocaleString();
                
                // 更新模型评估指标
                updateModelMetrics(response);
                
                // 更新可视化图表
                updateCharts(response);
                
                alert('模型训练完成！');
            } catch (error) {
                console.error('模型训练失败:', error);
                document.getElementById('trainingStatus').textContent = '训练失败';
                alert('模型训练失败，请重试');
            }
        }

        function updateModelMetrics(data) {
            // 更新回归模型指标
            document.getElementById('regressionMSE').textContent = data.regression.mse.toFixed(4);
            document.getElementById('regressionR2').textContent = data.regression.r2.toFixed(4);
            
            // 更新分类模型指标
            document.getElementById('classificationAccuracy').textContent = 
                (data.classification.accuracy * 100).toFixed(2) + '%';
            document.getElementById('classificationF1').textContent = 
                data.classification.f1.toFixed(4);
            
            // 更新评估表格
            updateEvaluationTable(data);
        }

        function updateEvaluationTable(data) {
            const tbody = document.getElementById('modelEvaluationTable');
            tbody.innerHTML = `
                <tr>
                    <td>回归模型</td>
                    <td>MSE</td>
                    <td>${data.regression.train_mse.toFixed(4)}</td>
                    <td>${data.regression.test_mse.toFixed(4)}</td>
                    <td>${data.regression.cv_mse.toFixed(4)}</td>
                </tr>
                <tr>
                    <td>回归模型</td>
                    <td>R²</td>
                    <td>${data.regression.train_r2.toFixed(4)}</td>
                    <td>${data.regression.test_r2.toFixed(4)}</td>
                    <td>${data.regression.cv_r2.toFixed(4)}</td>
                </tr>
                <tr>
                    <td>分类模型</td>
                    <td>准确率</td>
                    <td>${(data.classification.train_accuracy * 100).toFixed(2)}%</td>
                    <td>${(data.classification.test_accuracy * 100).toFixed(2)}%</td>
                    <td>${(data.classification.cv_accuracy * 100).toFixed(2)}%</td>
                </tr>
            `;
        }

        function updateCharts(data) {
            // 特征重要性图表
            const featureImportanceChart = echarts.init(document.getElementById('featureImportanceChart'));
            featureImportanceChart.setOption({
                title: {
                    text: '特征重要性分析'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                xAxis: {
                    type: 'value'
                },
                yAxis: {
                    type: 'category',
                    data: data.feature_importance.features
                },
                series: [{
                    name: '重要性',
                    type: 'bar',
                    data: data.feature_importance.importance
                }]
            });

            // 预测结果分布图表
            const predictionDistributionChart = echarts.init(document.getElementById('predictionDistributionChart'));
            predictionDistributionChart.setOption({
                title: {
                    text: '预测分数分布'
                },
                tooltip: {
                    trigger: 'axis'
                },
                xAxis: {
                    type: 'category',
                    data: data.prediction_distribution.bins
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    name: '频数',
                    type: 'bar',
                    data: data.prediction_distribution.counts
                }]
            });
        }

        // 视频分析相关变量
        let analysisInterval = null;
        let remainingSeconds = 180; // 3分钟
        let timerInterval = null;
        let analysisData = {
            focus: [],
            fatigue: [],
            distraction: []
        };

        // 开始视频分析
        function startVideoAnalysis() {
            if (analysisInterval) return;
            
            document.getElementById('analysisStatus').textContent = '分析中';
            document.getElementById('analysisStatus').parentElement.parentElement.classList.add('analysis-active');
            remainingSeconds = 180;
            
            // 初始化视频流
            const video = document.getElementById('analysisVideo');
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(err => {
                    console.error('摄像头访问失败:', err);
                    alert('无法访问摄像头，请检查权限设置');
                });
            
            // 开始定时更新数据
            analysisInterval = setInterval(updateAnalysisData, 1000);
            // 开始倒计时
            timerInterval = setInterval(updateRemainingTime, 1000);
        }

        // 停止视频分析
        function stopVideoAnalysis() {
            if (!analysisInterval) return;
            
            clearInterval(analysisInterval);
            clearInterval(timerInterval);
            analysisInterval = null;
            timerInterval = null;
            
            // 停止视频流
            const video = document.getElementById('analysisVideo');
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            
            document.getElementById('analysisStatus').textContent = '已停止';
            document.getElementById('analysisStatus').parentElement.parentElement.classList.remove('analysis-active');
            document.getElementById('remainingTime').textContent = '00:00';
            
            // 显示分析结果
            showAnalysisResults();
        }

        // 更新剩余时间
        function updateRemainingTime() {
            if (remainingSeconds <= 0) {
                stopVideoAnalysis();
                return;
            }
            
            const minutes = Math.floor(remainingSeconds / 60);
            const seconds = remainingSeconds % 60;
            
            const timeElement = document.getElementById('remainingTime');
            timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // 当剩余时间少于30秒时改变颜色
            if (remainingSeconds <= 30) {
                timeElement.style.color = '#e74a3b';
            } else {
                timeElement.style.color = '#4e73df';
            }
            
            remainingSeconds--;
        }

        // 更新分析数据
        function updateAnalysisData() {
            // 模拟数据更新
            const focus = Math.random() * 100;
            const fatigue = Math.random() * 100;
            const distraction = Math.floor(Math.random() * 4);
            
            // 更新状态卡片
            document.getElementById('focusScore').textContent = focus.toFixed(1) + '%';
            document.getElementById('fatigueScore').textContent = fatigue.toFixed(1) + '%';
            document.getElementById('distractionLevel').textContent = distraction;
            
            // 更新实时数据表格
            document.getElementById('focusValue').textContent = focus.toFixed(1) + '%';
            document.getElementById('fatigueValue').textContent = fatigue.toFixed(1) + '%';
            document.getElementById('distractionValue').textContent = distraction;
            
            // 更新状态指示
            updateStatusIndicators(focus, fatigue, distraction);
            
            // 收集分析数据
            analysisData.focus.push(focus);
            analysisData.fatigue.push(fatigue);
            analysisData.distraction.push(distraction);
        }

        // 更新状态指示
        function updateStatusIndicators(focus, fatigue, distraction) {
            // 专注度状态
            const focusStatus = document.getElementById('focusStatus');
            if (focus >= 80) {
                focusStatus.innerHTML = '<span class="badge bg-success">优秀</span>';
            } else if (focus >= 60) {
                focusStatus.innerHTML = '<span class="badge bg-primary">良好</span>';
            } else if (focus >= 40) {
                focusStatus.innerHTML = '<span class="badge bg-warning">一般</span>';
            } else {
                focusStatus.innerHTML = '<span class="badge bg-danger">需关注</span>';
            }
            
            // 疲劳度状态
            const fatigueStatus = document.getElementById('fatigueStatus');
            if (fatigue <= 30) {
                fatigueStatus.innerHTML = '<span class="badge bg-success">正常</span>';
            } else if (fatigue <= 50) {
                fatigueStatus.innerHTML = '<span class="badge bg-primary">轻度</span>';
            } else if (fatigue <= 70) {
                fatigueStatus.innerHTML = '<span class="badge bg-warning">中度</span>';
            } else {
                fatigueStatus.innerHTML = '<span class="badge bg-danger">重度</span>';
            }
            
            // 分心状态
            const distractionStatus = document.getElementById('distractionStatus');
            const distractionLabels = ['专注', '轻度分心', '中度分心', '重度分心'];
            const distractionColors = ['success', 'primary', 'warning', 'danger'];
            distractionStatus.innerHTML = `<span class="badge bg-${distractionColors[distraction]}">${distractionLabels[distraction]}</span>`;
        }

        // 显示分析结果
        function showAnalysisResults() {
            const tbody = document.getElementById('analysisTableBody');
            
            // 计算统计数据
            const stats = {
                focus: calculateStats(analysisData.focus),
                fatigue: calculateStats(analysisData.fatigue),
                distraction: calculateStats(analysisData.distraction)
            };
            
            tbody.innerHTML = `
                <tr>
                    <td>专注度</td>
                    <td>${stats.focus.avg.toFixed(1)}%</td>
                    <td>${stats.focus.max.toFixed(1)}%</td>
                    <td>${stats.focus.min.toFixed(1)}%</td>
                    <td>${getStatusBadge(stats.focus.avg, 'focus')}</td>
                </tr>
                <tr>
                    <td>疲劳度</td>
                    <td>${stats.fatigue.avg.toFixed(1)}%</td>
                    <td>${stats.fatigue.max.toFixed(1)}%</td>
                    <td>${stats.fatigue.min.toFixed(1)}%</td>
                    <td>${getStatusBadge(stats.fatigue.avg, 'fatigue')}</td>
                </tr>
                <tr>
                    <td>分心等级</td>
                    <td>${stats.distraction.avg.toFixed(1)}</td>
                    <td>${stats.distraction.max.toFixed(1)}</td>
                    <td>${stats.distraction.min.toFixed(1)}</td>
                    <td>${getDistractionBadge(stats.distraction.avg)}</td>
                </tr>
            `;
            
            document.getElementById('analysisResults').style.display = 'block';
        }

        // 计算统计数据
        function calculateStats(data) {
            return {
                avg: data.reduce((a, b) => a + b, 0) / data.length,
                max: Math.max(...data),
                min: Math.min(...data)
            };
        }

        // 获取状态徽章
        function getStatusBadge(value, type) {
            if (type === 'focus') {
                if (value >= 80) return '<span class="badge bg-success">优秀</span>';
                if (value >= 60) return '<span class="badge bg-primary">良好</span>';
                if (value >= 40) return '<span class="badge bg-warning">一般</span>';
                return '<span class="badge bg-danger">需关注</span>';
            } else {
                if (value <= 30) return '<span class="badge bg-success">正常</span>';
                if (value <= 50) return '<span class="badge bg-primary">轻度</span>';
                if (value <= 70) return '<span class="badge bg-warning">中度</span>';
                return '<span class="badge bg-danger">重度</span>';
            }
        }

        // 获取分心等级徽章
        function getDistractionBadge(value) {
            const level = Math.round(value);
            const labels = ['专注', '轻度分心', '中度分心', '重度分心'];
            const colors = ['success', 'primary', 'warning', 'danger'];
            return `<span class="badge bg-${colors[level]}">${labels[level]}</span>`;
        }

        // 导出分析数据
        function exportAnalysisData() {
            const stats = {
                focus: calculateStats(analysisData.focus),
                fatigue: calculateStats(analysisData.fatigue),
                distraction: calculateStats(analysisData.distraction)
            };
            
            const data = [
                {
                    '指标': '专注度',
                    '平均值': stats.focus.avg.toFixed(1) + '%',
                    '最高值': stats.focus.max.toFixed(1) + '%',
                    '最低值': stats.focus.min.toFixed(1) + '%',
                    '状态评估': getStatusBadge(stats.focus.avg, 'focus').replace(/<[^>]+>/g, '')
                },
                {
                    '指标': '疲劳度',
                    '平均值': stats.fatigue.avg.toFixed(1) + '%',
                    '最高值': stats.fatigue.max.toFixed(1) + '%',
                    '最低值': stats.fatigue.min.toFixed(1) + '%',
                    '状态评估': getStatusBadge(stats.fatigue.avg, 'fatigue').replace(/<[^>]+>/g, '')
                },
                {
                    '指标': '分心等级',
                    '平均值': stats.distraction.avg.toFixed(1),
                    '最高值': stats.distraction.max.toFixed(1),
                    '最低值': stats.distraction.min.toFixed(1),
                    '状态评估': getDistractionBadge(stats.distraction.avg).replace(/<[^>]+>/g, '')
                }
            ];
            
            const csv = convertToCSV(data);
            downloadCSV(csv, '课堂分析结果.csv');
        }

        // 转换为CSV格式
        function convertToCSV(data) {
            const headers = Object.keys(data[0]);
            const rows = data.map(obj => headers.map(header => obj[header]));
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        // 下载CSV文件
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // 学生信息数据与功能
        let studentList = [];
        let currentEditId = null;
        // 切换页面时加载学生信息
        document.querySelectorAll('.nav-link[data-page]').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.getAttribute('data-page') === 'student-info') {
                    renderStudentList();
                }
            });
        });
        // 渲染学生列表
        function renderStudentList(filterNo = '') {
            const tbody = document.getElementById('studentListBody');
            let list = studentList;
            if (filterNo) {
                list = list.filter(s => s.studentNo.includes(filterNo));
            }
            // 预警程度分类逻辑
            list = list.map(s => ({
                ...s,
                warningLevel: getWarningLevelByScore(Number(s.examScore))
            }));
            // 按预警程度筛选
            const warningFilter = document.getElementById('warningFilter')?.value || 'all';
            if (warningFilter !== 'all') {
                list = list.filter(s => s.warningLevel === warningFilter);
            }
            if (warningSortOrder) {
                list = [...list].sort((a, b) => {
                    const levels = ['正常','轻度预警','中度预警','重度预警'];
                    const aIdx = levels.indexOf(a.warningLevel||'正常');
                    const bIdx = levels.indexOf(b.warningLevel||'正常');
                    return warningSortOrder === 'asc' ? aIdx - bIdx : bIdx - aIdx;
                });
            }
            tbody.innerHTML = list.map(s => `
                <tr class="${getRowBgClass(s.warningLevel)}">
                    <td><a href="#" onclick="showStudentDetail('${s.id}')">${s.studentNo}</a></td>
                    <td>${renderWarningLevelBadge(s.warningLevel)}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editStudent('${s.id}')"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteStudent('${s.id}')"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }
        // 搜索
        function searchStudentByNo() {
            const no = document.getElementById('searchStudentNo').value.trim();
            renderStudentList(no);
        }
        // 显示详细信息
        function showStudentDetail(id) {
            const s = studentList.find(x => x.id === id);
            if (!s) return;
            document.getElementById('studentDetailBody').innerHTML = `
                <ul class="list-group">
                    <li class="list-group-item"><b>学号：</b>${s.studentNo}</li>
                    <li class="list-group-item"><b>姓名：</b>${s.name}</li>
                    <li class="list-group-item"><b>身份证号：</b>${s.idCard}</li>
                    <li class="list-group-item"><b>专业：</b>${s.major}</li>
                    <li class="list-group-item"><b>年级：</b>${s.grade}</li>
                    <li class="list-group-item"><b>GPA：</b>${s.gpa}</li>
                    <li class="list-group-item"><b>出勤率：</b>${s.attendance}%</li>
                    <li class="list-group-item"><b>在线学习时长：</b>${s.studyTime}小时</li>
                    <li class="list-group-item"><b>借阅次数：</b>${s.borrowCount}次</li>
                    <li class="list-group-item"><b>活动次数：</b>${s.activityCount}次</li>
                    <li class="list-group-item"><b>考试分数：</b>${s.examScore}</li>
                </ul>
            `;
            new bootstrap.Modal(document.getElementById('studentDetailModal')).show();
        }
        // 打开添加学生模态框
        function openAddStudentModal() {
            currentEditId = null;
            document.getElementById('addEditModalTitle').textContent = '添加学生';
            document.getElementById('addEditStudentForm').reset();
            new bootstrap.Modal(document.getElementById('addEditStudentModal')).show();
        }
        // 编辑学生
        function editStudent(id) {
            const s = studentList.find(x => x.id === id);
            if (!s) return;
            currentEditId = id;
            document.getElementById('addEditModalTitle').textContent = '编辑学生';
            document.getElementById('editStudentId').value = s.id;
            document.getElementById('editStudentNo').value = s.studentNo;
            document.getElementById('editName').value = s.name;
            document.getElementById('editIdCard').value = s.idCard;
            document.getElementById('editMajor').value = s.major;
            document.getElementById('editGrade').value = s.grade;
            document.getElementById('editGpa').value = s.gpa;
            document.getElementById('editAttendance').value = s.attendance;
            document.getElementById('editStudyTime').value = s.studyTime;
            document.getElementById('editBorrowCount').value = s.borrowCount;
            document.getElementById('editActivityCount').value = s.activityCount;
            document.getElementById('editExamScore').value = s.examScore;
            new bootstrap.Modal(document.getElementById('addEditStudentModal')).show();
        }
        // 保存学生
        function saveStudent() {
            const form = document.getElementById('addEditStudentForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            const examScore = document.getElementById('editExamScore').value;
            const s = {
                id: currentEditId || (Date.now() + ''),
                studentNo: document.getElementById('editStudentNo').value,
                name: document.getElementById('editName').value,
                idCard: document.getElementById('editIdCard').value,
                major: document.getElementById('editMajor').value,
                grade: document.getElementById('editGrade').value,
                gpa: document.getElementById('editGpa').value,
                attendance: document.getElementById('editAttendance').value,
                studyTime: document.getElementById('editStudyTime').value,
                borrowCount: document.getElementById('editBorrowCount').value,
                activityCount: document.getElementById('editActivityCount').value,
                examScore: examScore,
                warningLevel: getWarningLevelByScore(Number(examScore))
            };
            if (currentEditId) {
                const idx = studentList.findIndex(x => x.id === currentEditId);
                if (idx !== -1) studentList[idx] = s;
            } else {
                studentList.push(s);
            }
            bootstrap.Modal.getInstance(document.getElementById('addEditStudentModal')).hide();
            renderStudentList();
        }
        // 删除学生
        function deleteStudent(id) {
            document.getElementById('confirmDeleteBtn').onclick = function() {
                studentList = studentList.filter(x => x.id !== id);
                bootstrap.Modal.getInstance(document.getElementById('deleteStudentModal')).hide();
                renderStudentList();
            };
            new bootstrap.Modal(document.getElementById('deleteStudentModal')).show();
        }
        // 页面初始化时渲染一次
        document.addEventListener('DOMContentLoaded', function() {
            renderStudentList();
        });

        // 预警程度分类函数
        function getWarningLevelByScore(score) {
            if (score < 50) return '重度预警';
            if (score >= 50 && score < 60) return '中度预警';
            if (score >= 60 && score < 65) return '轻度预警';
            return '正常';
        }
        // 预警程度颜色徽章
        function renderWarningLevelBadge(level) {
            if (level === '重度预警') return '<span class="badge bg-danger">重度预警</span>';
            if (level === '中度预警') return '<span class="badge bg-warning text-dark">中度预警</span>';
            if (level === '轻度预警') return '<span class="badge bg-info text-dark">轻度预警</span>';
            return '<span class="badge bg-success">正常</span>';
        }
        // 表格行背景色
        function getRowBgClass(level) {
            if (level === '重度预警') return 'table-danger';
            if (level === '中度预警') return 'table-warning';
            if (level === '轻度预警') return 'table-info';
            if (level === '正常') return 'table-success';
            return '';
        }
    </script>
</body>
</html>